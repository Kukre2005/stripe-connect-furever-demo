<div
  class="relative z-10 bg-brand"
  style="box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06); height: 95px"
>
  <div class="flex justify-between items-stretch h-full">
    <div class="flex items-center bg-brand-dark xxs:px-4 xs:px-8 md:px-10">
      <a href="/" class="flex items-center pb-1">
        <img class="hidden xs:block" style="width: 145px; object-fit: contain; max-height: 100%; max-width: fit-content" src="/images/homebox_title.svg" alt="Homebox Logo" />
        <img class="xs:hidden block" style="width: 30px; object-fit: contain; max-height: 100%; max-width: fit-content" src="/images/homebox_logo.svg" alt="Homebox Logo" />
      </a>
    </div>
    <div class="bg-brand flex justify-end items-center w-full gap-4 {{#if session.isAuthenticated}}lg:justify-between xxs:px-4 xs:px-10 md:px-20{{else}}md:justify-between xxs:pl-4 xs:pl-10 md:pl-20 xxs:pr-4 xs:pr-8 md:pr-10{{/if}}">
      <nav class="h-full hidden {{#if session.isAuthenticated}}lg:flex{{else}}w-full md:flex{{/if}} md:items-center justify-between">
        {{#if session.isAuthenticated}}
          <div class="w-full flex flex-row justify-center items-center gap-10">
            <div
              class="flex justify-center items-center border-b-4 pt-3 pb-1 {{#if (eq route "Home")}} border-beige{{else}} border-transparent {{/if}} text-lg font-bold  text-white hover:text-beige"
            >
              <a href="/home">
                Home
              </a>
            </div>
            <div
              class="flex justify-center items-center border-b-4 pt-3 pb-1 {{#if (eq route "Payments")}} border-beige{{else}} border-transparent {{/if}} text-lg font-bold  text-white hover:text-beige"
            >
              <a href="/payments">
                Payments
              </a>
            </div>
            <div
              class="flex justify-center items-center border-b-4 pt-3 pb-1 {{#if (eq route "Payouts")}} border-beige{{else}} border-transparent {{/if}} text-lg font-bold  text-white hover:text-beige"
            >
              <a href="/payouts">
                Payouts
              </a>
            </div>
            <div
              class="flex justify-center items-center border-b-4 pt-3 pb-1 {{#if (eq route "Customers")}} border-beige{{else}} border-transparent {{/if}} text-lg font-bold  text-white hover:text-beige"
            >
              <a href="/customers">
                Customers
              </a>
            </div>
            <div
              class="flex justify-center items-center border-b-4 pt-3 pb-1 {{#if (eq route "Services")}} border-beige{{else}} border-transparent {{/if}} text-lg font-bold  text-white hover:text-beige"
            >
              <a href="/services">
                Services
              </a>
            </div>
          </div>
        {{else}}
          <div class="w-full flex flex-row justify-end items-center">
            <div
              class="flex justify-center items-center border-b-4 pt-3 pb-1 {{#if (eq route "Login")}} border-beige{{else}} border-transparent {{/if}} text-lg font-bold  text-white hover:text-beige"
            >
              <a href="/signin">
                Login
              </a>
            </div>
            <a
              href="/signup/user"
              class="ml-8 inline-flex items-center justify-center px-4 py-2 shadow-sm text-lg font-bold bg-beige rounded-full active:ring-2 active:ring-offset-2 active:ring-beige"
            >
              Sign up
            </a>
          </div>
        {{/if}}
      </nav>
      <div class="flex items-center h-full {{#if session.isAuthenticated}}{{else}}md:hidden{{/if}}">
        <!-- Profile dropdown -->
        <div class="relative h-full flex justify-center items-center">
          <button
            id="user-profile-button"
            type="button"
            class="rounded-full flex text-sm"
            aria-expanded="false"
            aria-haspopup="true"
          >
            <span class="sr-only">
              Open user menu
            </span>
            <!-- Heroicon name: menu -->
            <svg
              class="text-white hover:text-beige h-8 w-8 flex {{#if session.isAuthenticated}}lg:hidden{{else}}md:hidden{{/if}}"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
            <span class="bg-beige hidden {{#if session.isAuthenticated}}lg:inline-flex{{/if}} items-center justify-center h-11 w-11 rounded-full">
              <span class="text-lg font-bold leading-none text-brand">
                {{userInitials session.userName}}
              </span>
            </span>
          </button>
          <div
            id="user-profile-menu"
            class="
              {{#if session.isAuthenticated}}
                lg:absolute lg:top-full lg:w-280 lg:h-auto lg:right-0 lg:left-auto lg:min-w-0
              {{else}}
                md:absolute md:top-full md:w-280 md:h-auto md:right-0 md:left-auto md:min-w-0
              {{/if}} 
              pt-6 pb-2 fixed min-w-340 w-screen h-screen top-0 left-0 w-text-white hidden flex flex-col gap-4 box-content origin-top-right mt-2 whitespace-nowrap rounded-2xl shadow-lg bg-brand-dark leading-5 z-50"
            role="menu"
            aria-orientation="vertical"
            aria-labelledby="user-menu-button"
            tabindex="-1"
          >
            {{#if session.isAuthenticated}}
            <div class="flex flex-col px-4">
              <div class="flex flex-row justify-between items-center">
                <span class="text-white text-lg font-bold">{{session.userName}}</span>
                <!-- Heroicon name: close -->
                <svg class="lg:hidden text-white font-bold hover:text-beige h-6 w-6 flex cursor-pointer" onclick="closeProfileMenu()"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </div>
              <span class="text-white text-base font-medium">
                {{session.userEmail}}
              </span>
            </div>
            <hr class="mx-4 bg-beige" style="height: 1px; border: none;">
            <div class="flex flex-col">
              <a href="/home" class="block lg:hidden {{#if (eq route "Home")}}bg-brand{{/if}} px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Home
              </a>
              <a href="/payments" class="block lg:hidden {{#if (eq route "Payments")}}bg-brand{{/if}} px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Payments
              </a>
              <a href="/payouts" class="block lg:hidden {{#if (eq route "Payouts")}}bg-brand{{/if}} px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Payouts
              </a>
              <a href="/customers" class="block lg:hidden {{#if (eq route "Customers")}}bg-brand{{/if}} px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Customers
              </a>
              <a href="/services" class="block lg:hidden {{#if (eq route "Services")}}bg-brand{{/if}} px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Services
              </a>
              <a href="/account" class="{{#if (eq route "Account")}}bg-brand{{/if}} px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Account
              </a>
              <a onclick="toggleBorder()" class="px-4 toggle-border text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand"></a>
              <a href="/signout" class="px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Sign out
              </a>
            </div>
            {{else}}
            <div class="flex flex-col">
              <div class="flex w-full justify-between items-center my-2 px-4">
                <a href="/" class="flex items-center pb-1">
                  <img style="width: 145px; object-fit: contain; max-height: 100%; max-width: fit-content" src="/images/homebox_title.svg" alt="Homebox Logo" />
                </a>
                <!-- Heroicon name: close -->
                <svg class="lg:hidden text-white font-bold hover:text-beige h-6 w-6 flex cursor-pointer" onclick="closeProfileMenu()"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </div>
              <hr class="mx-4 mt-2 mb-4 bg-beige" style="height: 1px; border: none;">
              <a href="/signin" class="block md:hidden {{#if (eq route "Login")}}bg-brand{{/if}} px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Login
              </a>
              <a href="/signup/user" class="block md:hidden px-4 text-md text-white font-bold block cursor-pointer py-4 hover:bg-brand">
                Sign up
              </a>
            </div>
            {{/if}}
          </div>
        </div>
      </div>
    </div>
  </div>
  {{> notifications }}
</div>
<script>
  // Uncomment this to automatically login instead of redirecting to the login page
  {{!-- document.querySelectorAll('a[href="/signin"]').forEach(el => {
    el.addEventListener('click', async (event) => {
      event.preventDefault();
      await fetch('/signin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json;charset=utf-8' },
        body: JSON.stringify({
          email: 'test@stripe.com',
          password: 'test'
        })
      });
      window.location = '/';
    });
  }); --}}

  const userProfileButton = document.getElementById('user-profile-button');
  const userProfileMenu = document.getElementById('user-profile-menu');
  if (userProfileButton) {
    userProfileButton.addEventListener('click', () => {
      toggleBorderHelper();
      userProfileMenu.classList.toggle('hidden');
    })
  }

  const closeProfileMenu = () => {
    userProfileMenu.classList.add('hidden');
  }

  // Close popover when clicking outside
  document.addEventListener('click', (event) => {
    if (userProfileButton && userProfileButton.contains(event.target)) {
      return;
    }
    if (userProfileMenu && !userProfileMenu.contains(event.target)) {
      userProfileMenu.classList.add('hidden');
    }
  });
</script>
